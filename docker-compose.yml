services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: letter-writer-backend
    restart: unless-stopped
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - ./letters:/app/letters
      - ./trace:/app/trace
      - ./jobs:/app/jobs
      # Mount CV directory if it's outside the project directory
      # Adjust the path to match your CV location:
      - ${CV_LOCAL_PATH:-./cv-external}:/app/cv-external
    environment:
      - DJANGO_DEBUG=true
      - DJANGO_ALLOWED_HOSTS=*
      # Firestore connection (uses Application Default Credentials)
      # Set GOOGLE_APPLICATION_CREDENTIALS to path to service account JSON
      # Or use gcloud auth application-default login
      - GOOGLE_CLOUD_PROJECT=${GOOGLE_CLOUD_PROJECT}
      - GOOGLE_APPLICATION_CREDENTIALS=${GOOGLE_APPLICATION_CREDENTIALS}
      - FIRESTORE_PROJECT_ID=${FIRESTORE_PROJECT_ID:-${GOOGLE_CLOUD_PROJECT}}
      - FIRESTORE_COLLECTION=${FIRESTORE_COLLECTION:-documents}
      # Override CV_PATH for Docker - uses path relative to /app (project root)
      # This overrides the CV_PATH from .env file, so local .env can keep Windows paths
      # The CV directory is mounted at /app/cv-external
      - CV_PATH=cv-external/Experience.md
    env_file:
      - .env
    command: python letter_writer_server/manage.py runserver 0.0.0.0:8000

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: letter-writer-frontend
    restart: unless-stopped
    ports:
      - "5173:5173"
    volumes:
      - ./letter_writer_web:/app
      - /app/node_modules
    environment:
      - VITE_API_URL=http://backend:8000
    depends_on:
      - backend
    command: npm run dev -- --host 0.0.0.0

# Volumes removed - no longer using Qdrant or MongoDB
# Firestore is a managed service, no local volumes needed

